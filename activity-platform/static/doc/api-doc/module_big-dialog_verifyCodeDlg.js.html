<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: module/big-dialog/verifyCodeDlg.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: module/big-dialog/verifyCodeDlg.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Services from 'commonJsDir/services.js';
let Dialog = require('@flyme/modaldialog');

require('./verifyCodeDlg.less');

/**
 * 显示验证码弹框
 * @param {string} title - 标题
 * @param {object} datas - {missionId: missionId}
 * @param {function} successFn - 成功的回调
 * @param {function} cancelCallback - 点击取消按钮的回调
 * @param {function} failFn - 验证失败的回调
 * @param {string} okTxt - 确定按钮文案
 * @param {string} cancelTxt - 取消按钮文案
 * @module showVerifyCodeDlg
 */
Dialog.showVerifyCodeDlg = function(title, datas, successFn, cancelCallback, failFn, okTxt, cancelTxt){
  let getCode = (cb)=>{
        Services.getCode((data)=>{
          cb('data:image/jpg;base64,' + data);
        });
      }

  getCode((url)=>{
    let dlg = Dialog.confirm({
          useBackground: false,
          clazz: 'verifycode-dlg',
          title: title,
          content: `&lt;div class='subTitle'>请先验证身份&lt;/div>&lt;div class='inputField'>&lt;input id='codeInput' type='text' placeholder='输入验证码' maxlength='4'/>&lt;img id='codeImg' src='${url}' data-id="refreshCode"/>&lt;/div>&lt;p id='errorTip' class='errorTip'>验证码错误&lt;/p>`,
          refreshCode(){
            getCode((url)=>{
              $(dlg.dialogDom).find('#codeImg').attr('src', url);
            });
            return true;
          },
          cancelCallback: cancelCallback,
          okCallback: () => {
            let $dlgDom = $(dlg.dialogDom);

            let verifyCode = $dlgDom.find('#codeInput').val();
            if(!verifyCode)
              return true;

            Services.receiveReward({missionId: datas.missionId, code: verifyCode},(ret)=>{
              let status = ret.status;
              if(status == 3){
                $dlgDom.find('.errorTip').show();
                return;
              }else if(status == 1){
                successFn &amp;&amp; successFn(ret);
              }else
                failFn &amp;&amp; failFn(status);
              dlg.closeDialog();

            });

            return true;
          },
          sureStr: okTxt || '我要验证',
          cancelStr: cancelTxt || '取消'
        });
  });
};

module.exports = Dialog.showVerifyCodeDlg;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ajax.html">ajax</a></li><li><a href="module-AppsGenerator.html">AppsGenerator</a></li><li><a href="module-AwardDialog.html">AwardDialog</a></li><li><a href="module-Dom.html">Dom</a></li><li><a href="module-httpService.html">httpService</a></li><li><a href="module-Lottery.html">Lottery</a></li><li><a href="module-Mock.html">Mock</a></li><li><a href="module-module_app_index.html">module/app/index</a></li><li><a href="module-Native.html">Native</a></li><li><a href="module-oauthService.html">oauthService</a></li><li><a href="module-showVerifyCodeDlg.html">showVerifyCodeDlg</a></li><li><a href="module-stateMachine.html">stateMachine</a></li><li><a href="module-tools.html">tools</a></li><li><a href="module-Track.html">Track</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="AppsInstallInit.html">AppsInstallInit</a></li><li><a href="ExtraWelfareList.html">ExtraWelfareList</a></li><li><a href="module-AppsGenerator-AppsGenerator.html">AppsGenerator</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-AwardDialog-AwardDialog.html">AwardDialog</a></li><li><a href="module-Mock-Mock.html">Mock</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jul 12 2018 17:29:08 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
