SMK.config.set("static_www",gVConfig["static"]);SMK.config.set("version","version=0.222"||gVConfig["ver"]);function substr2(str,a,b){if(!str){return""}var s=str.replace(/([^\x00-\xff])/g,"\x00$1");return(s.length<b)?s:s.substring(a,b).replace(/\x00/g,"")+"..."}(function($){$.aboveViewport=function(elem,offset){if(typeof offset=="undefined"){offset=0}var top=$(window).scrollTop()+offset;var elemTop=$(elem).offset().top+$(elem).height();return top>=elemTop};$.belowViewport=function(elem,offset){if(typeof offset=="undefined"){offset=0}var top=$(window).scrollTop()+$(window).height()+offset;var elemTop=$(elem).offset().top;return top<=elemTop};$.leftViewport=function(elem){var left=$(window).scrollLeft();var elemLeft=$(elem).offset().left+$(elem).width();return left>=elemLeft};$.rightViewport=function(elem){var left=$(window).scrollLeft()+$(window).width();var elemLeft=$(elem).offset().left;return left<=elemLeft};$.inViewport=function(elem,offset){if(typeof offset=="undefined"){offset=0}return !$.aboveViewport(elem)&&!$.belowViewport(elem,offset)&&!$.leftViewport(elem)&&!$.rightViewport(elem)};$.inViewportVertical=function(elem,offset){if(typeof offset=="undefined"){offset=0}return !$.aboveViewport(elem)&&!$.belowViewport(elem,offset)};$.inViewportHoz=function(elem){return !$.leftViewport(elem)&&!$.rightViewport(elem)};$.extend($.expr[":"],{"above-viewport":function(elem,i,match,arr){return $.aboveViewport(elem)},"below-viewport":function(elem,i,match,arr){return $.belowViewport(elem)},"left-viewport":function(elem,i,match,arr){return $.leftViewport(elem)},"right-viewport":function(elem,i,match,arr){return $.rightViewport(elem)},"in-viewport":function(elem,i,match,arr){var offset=match[3];return $.inViewport(elem,offset)},"ver-viewport":function(elem,i,match,arr){var offset=match[3];return $.inViewportVertical(elem,offset)},"hoz-viewport":function(elem,i,match,arr){return $.inViewportHoz(elem)}})})(jQuery);(function($,window){})(jQuery,window);SMK.namespace("SMK.play");(function(){var _lastObj=null,requestflag=false;var defin={zIndex:100,browserVersion:($.browser.msie&&(parseInt($.browser.version)<=6)?false:true),setSizeKey:"sr-size",setAdKey:"sr-adopen",setHistorKey:"sr-history",booktag:true,bookSizeLen:60,bookOffsetLine:5,box:null,load:$('<div class="sr-play-load"><div></div></div>'),bookShareUrl:null,bookShareViewUrl:null,bookBookshelfUrl:null,type:"post",data:{},retData:null,mark:"<br />",rightKey:true,copy:true,nextPage:true,nextScroll:false,advertise:true,adTime:300,adClose:false,dirCookieKey:"sr-dirbook",adTimer:null,off:false,setText:true,screenType:"vertical",maxScroll:700,spaceScroll:true,showLeftAanRight:true,playUrl:SMK.config.get("host")+"book/play/{0}.html",readHistor:true};var play=function(options){this.opt=$.extend({},defin,options);this.content=this.opt.box.find(".sr-play-box-scroll-text");this.adBoxLeft=this.opt.box.find(".sr-player-box-left");this.adBoxRight=this.opt.box.find(".sr-player-box-right");this.adPlayer=this.opt.box.find(".sr-player-content");this.boxScroll=this.opt.box.find(".sr-play-box-scroll");this.booksetEle=this.opt.box.find(".sr-play-box-scroll-t-box");this.booklistEle=this.opt.box.find(".sr-play-booklist");this.booktagsEle=this.opt.box.find(".sr-play-booktags");this.guessYouLike=this.opt.box.find(".sr-play-guessYouLike");this.bookNav=this.opt.box.find(".sr-play-box-nav").children();this.bookScrollTop=null;this.contentArray=null;this.progressEle=null;this.scrollObject={};this.widthSave=0;this.boxHeight=null;this.booktagsElelistStatus=false;this.lightsCookieKey="sr-light-status";this.windowTop=0;window.scrollTo(0,0);if(this.opt.rightKey){$("body").bind("contextmenu",function(){return false})}if(this.opt.copy){$(".sr-play-box-wrap").css({"-moz-user-select":"none","-webkit-user-select":"none"}).attr({"unselectable":"on","onselectstart":"return false"})}if(!this.opt.browserVersion){$("head").append('<style type="text/css">.sr-play-box-nav .sr-booktags { display:none} .sr-play-box-scroll-booktag { display:none;}</style>')}this.lightELement=this.opt.box.find(".sr-play-box-scroll-setup span.sr-off");if(!SMK.cookie.get(this.lightsCookieKey)){$("body").removeClass("sr-player-off");this.lightELement.find("em").html("关灯")}else{if(SMK.cookie.get(this.lightsCookieKey)==1){$("body").removeClass("sr-player-off");this.lightELement.find("em").html("关灯")}else{$("body").addClass("sr-player-off");this.lightELement.find("em").html("开灯")}}};play.prototype={init:function(){if(!this.opt.box){return null}return this},__construct:function(reszType){var that=this;var isComic=this.opt.isComic;if(!this.opt.box){return null}if(this.content.find("p").length==0){this.opt.load.children().css({"height":$(window).height()-100});var cssSize=SMK.cookie.get(this.opt.setSizeKey)?SMK.cookie.get(this.opt.setSizeKey):"fn16";this.content.html(this.opt.load).addClass(cssSize)}this.resizes();this.setStyle();this.getData(reszType==undefined?true:false);!isComic&&this.setTextSize();this.advertise();this.readProgress();this.chapterError();
this.changeType();var tag="on";$(window).scroll(function(){var docHeight=$(document).height(),winHeight=$(window).height(),winScrollTop=$(window).scrollTop();if(winScrollTop>=docHeight-winHeight&&tag=="on"){that.bookshelfTip();tag="off"}})},error:function(desc,ret){if(gVConfig.debug){var text=ret.responseText!=undefined?ret.responseText:"";console.log(desc+"\n"+ret.responseText)}},resizeAuto:function(){if(!this.opt.browserVersion){var contentPay=this.opt.box.find(".sr-play-contentPay");var h=this.boxHeight?this.boxHeight:this.boxScroll.height();this.adPlayer.css({height:h});$(contentPay).find(".sr-play-contentPay-list").css({height:"auto"});var temp=[];$(contentPay).find(".sr-play-contentPay-list").each(function(index,element){temp.push($(this).height())});var maxHeight=parseInt(Math.max.apply({},temp));$(contentPay).find(".sr-play-contentPay-list").css({height:maxHeight});this.widthSave=win;var winh=$(window).height();return}var maxWidth=this.opt.maxScroll;var minWidth=700;var maxMargin=70;var minMargin=40;var box=this.opt.box.find(".sr-play-box-wrap");var title=this.opt.box.find(".sr-play-box-scroll-t");var mask=this.opt.box.find(".sr-play-box-scroll-mask");var cont=this.opt.box.find(".sr-play-box-scroll");var text=this.opt.box.find(".sr-play-box-scroll-text");var contentPay=this.opt.box.find(".sr-play-contentPay");var footer=this.opt.box.find(".sr-play-footer");var guessYouLike=this.opt.box.find(".sr-play-guessYouLike");var marginLeft=parseInt(cont.css("margin-left"))||0;var border=parseInt(cont.css("border-left-width"))||0;var win=$(window).width()-60*2-2*2;var isComic=this.opt.isComic;var trigger=this.trigger;maxWidth=maxWidth<=minWidth?minWidth:maxWidth;if(isComic){maxWidth=trigger?(maxWidth-140*2):maxWidth;maxWidth=maxWidth<minWidth?minWidth:maxWidth;this.opt.maxScroll=maxWidth;$(".comic-page img").removeAttr("style").css({"max-width":maxWidth-8});$(".sr-play-box-scroll-t").css("width",maxWidth-8)}if(win<=maxWidth){var x=parseInt(maxMargin-(maxMargin-minMargin)*(maxWidth-win)/(maxWidth-minWidth));if(win>=minWidth){box.css({width:win+marginLeft*2+border*2});title.children().css({margin:"0 "+x+"px"});mask.css({width:win});if(!isComic){title.css({width:win});cont.css({width:win});this.booklistEle.css({width:win});this.booktagsEle.css({width:win});text.css({padding:"91px "+x+"px 1em"})}else{this.booklistEle.css({width:700,left:($(window).width()-700)/2})}contentPay.css({margin:"0 "+(x-border*2)+"px 2em"});footer.css({margin:"0 "+(x-border*2)+"px 2em"});guessYouLike.hide()}else{var _width=win+marginLeft*2+border*2;_width=_width<=minWidth?minWidth:_width;box.css({width:_width});title.children().css({margin:"0 "+minMargin+"px"});mask.css({width:_width});if(!isComic){title.css({width:_width});cont.css({width:_width});this.booklistEle.css({width:_width});this.booktagsEle.css({width:_width});text.css({padding:"91px "+minMargin+"px 1em"})}else{this.booklistEle.css({width:700,left:0})}contentPay.css({margin:"0 "+minMargin+"px 2em"});footer.css({margin:"0 "+minMargin+"px 2em"});guessYouLike.hide()}}else{title.children().css({margin:"0 "+(maxMargin-border*2)+"px"});if(!isComic){title.css({width:maxWidth});cont.css({width:maxWidth});this.booklistEle.css({width:maxWidth});this.booktagsEle.css({width:maxWidth});text.css({padding:"91px "+maxMargin+"px 1em"})}else{this.booklistEle.css({width:700,left:($(window).width()-700)/2})}contentPay.css({margin:"0 "+(maxMargin-border*2)+"px 2em"});footer.css({margin:"0 "+(maxMargin-border*2)+"px 2em"});guessYouLike.css({margin:"0 "+(maxMargin-border*2)+"px 2em"}).show()}mask.css({"position":"fixed"});$(contentPay).find(".sr-play-contentPay-list").css({height:"auto"});var temp=[];$(contentPay).find(".sr-play-contentPay-list").each(function(index,element){temp.push($(this).height())});var maxHeight=parseInt(Math.max.apply({},temp));$(contentPay).find(".sr-play-contentPay-list").css({height:maxHeight});this.widthSave=win;var winh=$(window).height();!isComic&&this.opt.box.find(".sr-play-box-scroll-c").css({"min-height":winh,"_height":winh});var doch=$(document).height();$("body").css("overflow","auto")},resizes:function(){var that=this,opt=that.opt;var timeer=null,i=0;$(window).unbind("resize").bind("resize",function(){if(timeer){clearTimeout(timeer)}if(that.content.is(":hidden")){that.content.parent().parent().css({height:$(window).height()})}timeer=setTimeout(function(){that.advertise();that.resizeAuto();that.initDirSize();if(that.opt.showLeftAanRight){that.showLeftAanRightCode()}},100);if($.browser.msie&&i==0){clearTimeout(timeer)}i++})},setStyle:function(){var that=this;if(this.opt.zIndex){var show=this.opt.box.find(".sr-play-box-wrap");var left=this.opt.box.find(".sr-player-box-left");var right=this.opt.box.find(".sr-player-box-right");if(show.length>0){show.css({"z-index":this.opt.zIndex+1})}if(left.length>0){left.css({"z-index":this.opt.zIndex+2})}if(right.length>0){right.css({"z-index":this.opt.zIndex+2})}}},bintEvts:function(){var that=this;that.opt.box.find(".sr-play-nextPrve .sr-prve,.sr-play-nextPrve .sr-next").click(function(){if($(this).hasClass("sr-prve")){var str=".sr-prve"
}else{var str=".sr-next"}that.bookNav.children(str).click();return false});that.opt.box.find(".sr-play-nextPrve .sr-booklist").click(function(){that.bookNav.find(".sr-booklist").click()})},main:function(){var that=this,opt=that.opt,box=opt.box;if(that.opt.spaceScroll&&that.opt.browserVersion){that.spaceScrollHeight=0;$(document).keydown(function(e){if(e.keyCode==32||e.keyCode==34){that.spaceScrollCode(1);return false}if(e.keyCode==33){that.spaceScrollCode(-1);return false}})}var _queue=[function(){that.bookshelf();_takeDequeue()},];box.queue("main",_queue);function _takeDequeue(){setTimeout(function(){box.dequeue("main")},10)}that.createDir();_takeDequeue();that.boxHeight=parseInt(Math.max($(window).height(),that.boxScroll.height()))-27+"px";if(!that.opt.browserVersion){if(parseInt($(window).height())>=parseInt(that.boxHeight)){that.boxScroll.css({height:$(window).height()})}that.adPlayer.css({height:parseInt(that.boxHeight)})}that.bintEvts();$(".sr-play-disabled").click(function(){return false});$(that.opt.box).find(".sr-play-setup .sr-comment,.sr-getbook .up a.sr-play-red").click(function(){if(!SMK.util.getLoginStatus()){SMK.util.checkLogin("",{tpl:"dialog2_html",isDialog:false});return false}else{return true}});if(that.opt.showLeftAanRight){that.showLeftAanRightCode()}},checkCon:function(type,content){if(content=="请详细填写，以确保举报能被受理"&&(type=="5"||type=="4")){content="";return false}else{$(".report_box").removeClass("error");return true}},getData:function(reszType){var that=this;if(requestflag){return}requestflag=true;if(!reszType){setTimeout(function(){that.retCallback()},10);requestflag=false;return}$(".sr-js-play-box-scroll-c").prepend("Some text");that.resizeAuto();that.retCallback();that.setupTitle(chapterTitle);that.main()},showLeftAanRightCode:function(){var win=$(window).height();var eleL=this.opt.box.find(".sr-player-box-left .sr-player-content");var padding=parseInt(eleL.css("padding-top"));var leftMinH=eleL.find(".userinfo").outerHeight(true);var eleLH=0;$(eleL).children().each(function(index,element){if(!$(this).hasClass("userinfo")){eleLH=eleLH+$(this).outerHeight(true)}});if(eleLH+padding+leftMinH>win){eleL.find(".userinfo").hide()}else{eleL.find(".userinfo").show()}var eleR=this.opt.box.find(".sr-player-box-right .sr-player-content");var rightMinH=eleR.find(".sr-rightBook").show().children().eq(0).outerHeight(true)+eleR.find(".sr-rightBook").show().children().eq(1).outerHeight(true);var bookIndex=eleR.find(".sr-returnIndex").outerHeight(true);var booktext=eleR.find(".sr-ritbotxt").outerHeight(true);var list=eleR.find(".sr-rightBook-list");var height=(win-bookIndex-booktext)/rightMinH<=1?1:((win-bookIndex-booktext)/rightMinH>=3?"auto":Math.floor((win-bookIndex-booktext)/rightMinH));list.css({height:height=="auto"?"auto":height*rightMinH})},spaceScrollCode:function(type){var that=this;var top=parseInt(this.content.css("padding-top"));var win=$(window).height();var line=parseInt(parseInt($(this.content).find("span").css("line-height"))*1.5);var scrollTop=this.spaceScrollHeight+type*((win-top)-line);$("body,html").animate({scrollTop:scrollTop},500,function(){that.spaceScrollHeight=scrollTop});this.scrollObject["setSpaceScrollHeight"]=function(){that.spaceScrollHeight=$(window).scrollTop()}},sequence:function(ele){function sort(obj){var child=$(obj).children();var next=0;var len=$(obj).children().length-1;for(var i=len;i>=0;i--){if(next==len){continue}$(obj).children().eq(next).before($(obj).children().eq(len));next++}}if(ele.attr("class")=="sr-play-booklist-yes"){$ul=ele.find("ul");$ul.each(function(){sort(this)})}sort(ele)},setupTitle:function(title){this.content.find('h1[node-type="title"]').html(title)},newsCopy:function(){var copyTpl="";if(_cfg.is_public=="1"){copyTpl+='<div class="s-news-copy"><div class="copy-wrapper"><h2>'+_cfg.book_name+'</h2><p class="copy-author">作者：'+_cfg.author_name+'</p><div class="copy-line"></div><p class="copy-text">本书由北京新浪阅读信息技术有限公司策划整理，制作并发行，侵权必究。</p></div></div>'}return copyTpl},retCallback:function(){var html="";var maxWidth=this.opt.maxScroll;chapterContent=typeof chapterContent!="undefined"?chapterContent:"";if(!chapterContent){chapterContent="@=@"}if(!this.opt.isComic){html="<p>";html+=chapterContent.replace(/\r|\r\n|<br\/>|<br>|<br \/>/g,"<p>");html=_cfg.is_first_chapter=="1"?this.newsCopy()+'<h1 node-type="title"></h1>'+html:'<h1 node-type="title"></h1>'+html}else{html=$("<div></div>");var _img=chapterContent.replace(/\.jpg/g,"_small.jpg");html.html(_img)}this.content.html(html);$(window).trigger("resize");if(chapterContent=="@=@"){this.content.children().css({visibility:"hidden","padding-bottom":0,height:1,overflow:"hidden"});this.opt.box.find(".sr-play-box-progress").hide()}var h=Math.max($(window).height(),$("body").height());this.opt.box.find(".sr-lightsMark").css({width:"100%",height:h});this.bookScrollTop=this.opt.box.find(".sr-play-box-scroll-t").outerHeight()+this.opt.box.find(".sr-play-box-scroll-mask").outerHeight();this.nextPageCode();equestflag=false;
SMK.log("end")},getSizePosition:function(){return;var that=this;var tempContentHeihgt=this.bookScrollTop;this.content.children().each(function(index,element){var h=$(this).outerHeight();$(this).attr({"data-max":tempContentHeihgt+h,"data-min":tempContentHeihgt});tempContentHeihgt=tempContentHeihgt+h});var startOffset=$(window).scrollTop()+this.bookScrollTop+5;var actEle=null;var dh=0;var index=0;that.content.find("p").each(function(i,element){var mx=$(this).attr("data-max");var mn=$(this).attr("data-min");if(startOffset>=mn&&startOffset<=mx){actEle=$(this);dh=$(this).children().eq(3).height();index=i;return false}});if(!actEle){SMK.log("start");return{ele:that.content.find("p").eq(0),offset:0,span:that.content.find("p").eq(0).find("span").eq(3),index:0}}var offset=0;var maxLineNum=Math.ceil(actEle.height()/dh);var nowlineHeight=(startOffset-Math.floor(actEle.offset().top))/dh;if(nowlineHeight>=maxLineNum){index=index+1;actEle=that.content.find("p").eq(index)}else{var temp=0;var longs=$(actEle).width()*(Math.ceil(nowlineHeight)-1);if(longs>0){$(actEle).children().each(function(index,element){temp=temp+$(this).width();if(temp>longs){offset=parseInt($(this).attr("data-offset"));return false}})}}return{ele:actEle,offset:offset,span:actEle.find('span[data-offset="'+offset+'"]'),index:index}},scroll:function(fnc){var that=this;var timeer=null;$(window).unbind("scroll").bind("scroll",function(e){if(timeer){clearTimeout(timeer)}timeer=setTimeout(function(){for(var key in that.scrollObject){if(typeof that.scrollObject[key]=="function"){that.scrollObject[key]()}}},300)})},getLenText:function(pid,offset){var that=this;var obj=that.getSizePosition();var pid=pid?pid:obj.ele.attr("data-pid").split("_")[1];var offset=offset?offset:obj.offset;var strLen=that.contentArray[pid].length;var str="";if(strLen<=that.opt.bookSizeLen){str=that.contentArray[pid]}else{if((strLen-offset)<that.opt.bookSizeLen){var temp1=that.contentArray[pid].slice(offset);var temp2=that.contentArray[pid].slice(offset-(that.opt.bookSizeLen-temp1.length),offset);str=temp2+temp1}else{str=that.contentArray[pid].slice(offset,offset+that.opt.bookSizeLen)}}var _data={text:str,pid:pid,offset:offset};return{"ele":obj.ele,"data":_data}},createBooktagReSize:function(){var booktagsEleTop=parseInt(this.booktagsEle.children().css("margin-top"))+this.booktagsEle.find(".sr-play-booktags-t").outerHeight(true)+parseInt(this.createBooktagCont.css("margin-top"))+20;this.createBooktagCont.css({height:$(window).height()-booktagsEleTop})},getFollow:function(callback){},follow:function(){},__tpl:function(str,data){},renderRecommend:function(){},fetchRecommend:function(callback){var that=this;$.ajax({url:that.opt.bookRecommendUrl,type:"GET",data:{"cate_id":that.opt.cateId,"book_id":that.opt.bookId},dataType:"json",success:function(data){if(data.code>=1){callback&&callback(data.data)}}})},bookshelf:function(){var that=this;$.ajax({url:_cfg["static"]+"paidRead/assets/js/play/sr.bookshelf.js?"+SMK.config.get("version"),dataType:"script",cache:true,success:function(data,a){var $bookShelf=that.opt.box.find(".sr-js-bookshelf-btn");if(SMK.util.getLoginStatus()){var txt,val;function req(action){$.ajax({url:that.opt.bookNewBookshelfUrl+"?action="+action,type:"POST",dataType:"json",data:{bids:that.opt.bookId}}).done(function(data){if(data.error_code==0){if(action=="check"){if(data.data[that.opt.bookId]==0){txt="加入书架";val="add"}else{txt="查看书架";val="display"}}else{if(data.data[that.opt.bookId]==0){txt="查看书架";val="display";$(".bookshelfTip").fadeOut()}else{txt="加入书架";val="add"}}}$bookShelf.each(function(i,el){var $el=$(el);$el.attr("data-enable",val);$el.find("em").text(txt)})}).fail(function(){SMK.util.globalTips("请求失败,请重试")})}req("check");$bookShelf.on("click",function(){var val=$bookShelf.attr("data-enable");if(!val){return}if(val=="add"){req("add")}else{if(val=="display"){location.href=that.opt.userbookShelfListUrl}}});$(".sr-bookshelf").on("click",function(){location.href=that.opt.userbookShelfListUrl})}else{$bookShelf.add(".sr-bookshelf").on("click",function(){SMK.util.checkLogin("",{isDialog:false,tpl:"dialog2_html"});return false})}}})},bookshelfTip:function(){var _this=this;var book_id=$(".bookshelfTip").attr("bookid");if(book_id==undefined){return}if($(".sr-js-bookshelf-btn").attr("data-enable")=="display"){return}var bookTagIndex=SMK.cookie.get("TagIndex"+book_id);$.ajax({url:_this.opt.bookNewBookshelfUrl+"?action=check",type:"POST",dataType:"json",data:{bids:book_id}}).done(function(data){if(data.error_code==-10){return}var statusCoce=data.data[book_id];if(statusCoce==0&&bookTagIndex==null){SMK.cookie.set("TagIndex"+book_id,book_id+"one")}else{if(statusCoce==0&&bookTagIndex==book_id+"one"){SMK.cookie.set("TagIndex"+book_id,book_id+"two")}else{if((statusCoce==0&&bookTagIndex==book_id+"two")){$(".bookshelfTip").fadeIn(500)}}}}).fail(function(){SMK.util.globalTips("请求失败,请重试")});$(".bookshelfTip").find(".close").on("click",function(){$(".bookshelfTip").fadeOut();SMK.cookie.set("TagIndex"+book_id,3)
})},nextPageCode:function(){var that=this;var code=function(ele){var url=ele.attr("data-url");window.location.href=url};this.bookNav.children(".sr-prve,.sr-next").unbind("click").bind("click",function(){code($(this))});$(document).keyup(function(e){if(e.keyCode==39){that.bookNav.children(".sr-next").click()}if(e.keyCode==37){that.bookNav.children(".sr-prve").click()}})},createDir:function(){var that=this;this.activeT=0;this.activeTLen=0;this.activeC=0;this.activeCLen=0;this.dirType=0;var dirCallback=function(ret,chapterid){var bookAllDir=that.booklistEle.find(".sr-play-booklist-c").addClass("sr-play-booklist-c-hide");var bookListNo=bookAllDir.find(".sr-play-booklist-no");var bookListYes=bookAllDir.find(".sr-play-booklist-yes");var bookDir="";that.dirType=ret.data.type;if(ret.data.type==1){bookDir="<ul>";for(var i=0;i<ret.data.list.length;i++){var status="";if(ret.data.list[i].status==""){if(chapterid==ret.data.list[i].chapter_id){status='class="active"'}}else{if(chapterid==ret.data.list[i].chapter_id){status="class='active "+ret.data.list[i].status+"'"}else{status="class="+ret.data.list[i].status}}bookDir+="<li "+status+'><a href="'+ret.data.list[i].chapter_url+'"><i></i><em>'+ret.data.list[i].chapter_name+"</em></a></li>";if(status.indexOf("active")!=-1){that.activeC=i}}bookDir+="</ul>";bookListNo.append(bookDir)}else{if(ret.data.type==2){var count=0;that.activeTLen=ret.data.list.length;for(var i=0;i<that.activeTLen;i++){bookDir+="<div class='sr-play-booklist-list'><div class='sr-play-booklist-list-t'><p>"+ret.data.list[i].volume_name+"</p><div class='sr-more'><i class='up'></i></div></div><div class='sr-play-booklist-list-c sr-booklist-ul'><ul>";var templen=ret.data.list[i].chapters.length;for(var j=0;j<templen;j++){var status="";if(!ret.data.list[i].chapters[j].status){if(chapterid==ret.data.list[i].chapters[j].chapter_id){status='class="active"'}}else{if(chapterid==ret.data.list[i].chapters[j].chapter_id){status="class='active "+ret.data.list[i].chapters[j].status+"'"}else{status="class="+ret.data.list[i].chapters[j].status}}bookDir+="<li "+status+"><a href='"+ret.data.list[i].chapters[j].chapter_url+"'><i></i><em>"+ret.data.list[i].chapters[j].chapter_name+"</em></a></li>";if(status.indexOf("active")!=-1){that.activeT=count;that.activeC=j;that.activeCLen=templen}}bookDir+="</ul></div></div>";count++}bookListYes.append(bookDir)}}that.userDir()};var _data=SMK.util.getElData(that.booklistEle,"data-post");if(directoryData.code==1){dirCallback(directoryData,_data.chapterid)}else{if(directoryData.code==0){that.booklistEle.find(".sr-nodata-block").html("<p>"+directoryData.tipmsg+"</p>").show();that.booklistEle.find(".sr-cont-r").remove()}}},initDirSize:function(){var dirContent=this.booklistEle.find(".sr-play-booklist-c");var bookDirTop=parseInt(this.booklistEle.find(".sr-play-booklist-box").css("margin-top"))+parseInt(this.booklistEle.find(".sr-play-booklist-t").outerHeight(true))+parseInt(dirContent.css("margin-top"))+20;dirContent.css("height",$(window).height()-bookDirTop)},userDir:function(){var that=this;var dirBtn=that.bookNav.find(".sr-booklist");var resizeBtn=that.bookNav.find(".sr-bookSet");var yesClass=that.booklistEle.find(".sr-play-booklist-yes");var dirMore=that.booklistEle.find(".sr-play-booklist-list-t");var sr_cont=that.booklistEle.find(".sr-cont-r a");var scrollTop=null;if(that.opt.isComic){$(".js-comic-title").unbind("click").bind("click",function(){dirBtn.click()})}dirBtn.unbind("click").bind("click",function(){var dirWidth=$(window).width()-180-140*2;if($(this).hasClass("active")){that.booklistEle.find(".sr-close").click();resizeBtn.removeClass("cur");return}dirBtn.addClass("active").siblings().removeClass("active");resizeBtn.addClass("cur").siblings().removeClass("cur");if(that.windowTop==0){that.windowTop=$(window).scrollTop()}that.content.parent().parent().css({height:$(window).height()});$("html").css({"overflow-y":"hidden"});if(that.opt.isComic){$(".sr-play-box-scroll-t").hide();$(".sr-play-box-scroll-c").hide()}else{that.content.hide()}that.booktagsEle.hide();that.booklistEle.show();that.initDirSize();if(SMK.cookie.get(that.opt.dirCookieKey+"_"+that.opt.bookId)==1){SMK.log(sr_cont.eq(1));sr_cont.eq(1).click()}if(!$(this).attr("data-flag")){that.dirFocus();$(this).attr("data-flag",true)}});that.booklistEle.find(".sr-close").unbind().bind("click",function(){that.booklistEle.hide();that.bookNav.children().removeClass("active");if(that.opt.isComic){$(".sr-play-box-scroll-t").show();$(".sr-play-box-scroll-c").show()}else{that.content.show()}if(that.opt.browserVersion){that.content.parent().parent().css({height:"auto"})}window.scrollTo(0,that.windowTop);if(parseInt($(window).height())<parseInt(that.boxHeight)){$("html").css({"overflow-y":"auto"})}if(!that.opt.browserVersion){that.content.parent().parent().css({height:parseInt(that.boxHeight)+27+"px"})}that.windowTop=0});dirMore.live("click",function(){var childrens=$(this).find(".sr-more");var siblings=$(this).siblings();if(siblings.is(":hidden")){childrens.find("i").attr("class","up");
siblings.show()}else{childrens.find("i").attr("class","down");siblings.hide()}});sr_cont.unbind("click").bind("click",function(){if($(this).is(".active")){return}$(this).addClass("active").siblings().removeClass("active");if(yesClass.is(":hidden")){that.sequence(that.booklistEle.find(".sr-play-booklist-no ul"))}else{that.sequence(that.booklistEle.find(".sr-play-booklist-yes"))}if($(this).attr("node-type")=="pos"){SMK.cookie.set(that.opt.dirCookieKey+"_"+that.opt.bookId,0)}else{SMK.cookie.set(that.opt.dirCookieKey+"_"+that.opt.bookId,1)}})},dirFocus:function(){var that=this;if(this.booklistEle.find(".sr-play-booklist-c").html()==""){setTimeout(function(){that.dirFocus()},1000)}else{if(this.dirType==1){var winH=this.booklistEle.find(".sr-play-booklist-c").height();var contH=this.booklistEle.find(".sr-play-booklist-no").height();var list=this.booklistEle.find(".sr-play-booklist-no ul").children();var cH=(list.children().outerHeight()+parseInt(list.children().css("border-bottom-width")))*this.activeC;this.booklistEle.find(".sr-play-booklist-c").scrollTop((cH-top)<=0?0:(cH-top))}else{if(this.dirType==2){SMK.log(this);var sortStatus=null;this.booklistEle.find(".sr-cont-r a").each(function(){if($(this).hasClass("active")){sortStatus=$(this).attr("node-type")}});if(sortStatus=="des"){var tempT=this.activeTLen-this.activeT-1;var tempC=this.activeCLen-this.activeC-1}else{var tempT=this.activeT;var tempC=this.activeC}var list=this.booklistEle.find(".sr-play-booklist-yes").children();var act=list.eq(tempT);var sibling=act.siblings();if(act.find(".sr-booklist-ul").is(":hidden")){act.find(".sr-more").click()}sibling.each(function(index,element){if($(this).find(".sr-booklist-ul").is(":visible")){$(this).find(".sr-more").click()}});var winH=this.booklistEle.find(".sr-play-booklist-c").height();var contH=this.booklistEle.find(".sr-play-booklist-yes").height();var tH=sibling.outerHeight(true)*(tempT+1)+2;var cH=act.find("li").outerHeight(true)*(tempC-2);this.booklistEle.find(".sr-play-booklist-c").scrollTop(tH+cH)}}this.booklistEle.find(".sr-play-booklist-c").removeClass("sr-play-booklist-c-hide")}},offLights:function(){},setTextSize:function(){var that=this;var sr_playSetup=$(".sr-setup-wrap");var sr_setup=sr_playSetup.find(".sr-setup");var timer=null;if(!that.opt.setText){sr_setup.remove()}else{sr_playSetup.css({"z-index":this.opt.zIndex+1,"position":"relative"});var setTpl="<div class='sr-play-setsize' style='z-index:"+this.opt.zIndex+1+";width:230px;_width:231px;'><em></em><span>字号</span><a class='size1' node-type='setSize' node-data='fn14' title='14号' href='javascript:;'>1</a>			            <a class='size2 currSelect' node-type='setSize' node-data='fn16' title='16号' href='javascript:;'>2</a><a class='size3' node-type='setSize' node-data='fn18' title='18号' 			            href='javascript:;'>3</a><a class='size4' node-type='setSize' node-data='fn20' title='20号' href='javascript:;'>4</a><a class='size5' node-type='setSize' node-data='fn22' 			            title='22号' href='javascript:;'>5</a></div>";if(sr_playSetup.find(".sr-play-setsize").length<=0){sr_playSetup.append(setTpl)}var setLayer=sr_playSetup.find(".sr-play-setsize");sr_setup.hover(function(){clearTimeout(timer);if(setLayer.is(":hidden")){setLayer.show();var aClick=setLayer.find("a");if(SMK.cookie.get(that.opt.setSizeKey)){aClick.removeClass("currSelect");aClick.each(function(){if($(this).attr("node-data")==SMK.cookie.get(that.opt.setSizeKey)){$(this).addClass("currSelect")}})}aClick.unbind("click").bind("click",function(ev){ev.stopPropagation();var _this=$(this);_this.addClass("currSelect").siblings().removeClass("currSelect");var size=_this.attr("node-data");SMK.cookie.set(that.opt.setSizeKey,size,{expires:720});var addName=that.content.attr("class").split(" ")[0]+" "+size;that.content.attr("class",addName);setLayer.hide()})}else{var ele=ev.srcElement?ev.srcElement:ev.target;var parent=ele.parentNode.parentNode;if($(parent).hasClass("sr-setup")){return}else{if($(ele).hasClass("sr-play-setsize")){return}}setLayer.hide()}},function(){timer=setTimeout(function(){setLayer.hide()},100)});setLayer.hover(function(){clearTimeout(timer)},function(){timer=setTimeout(function(){setLayer.hide()},100)})}},advertise:function(){var that=this;var isComic=that.opt.isComic;var oLeft=parseInt(that.adBoxLeft.width());var oRight=parseInt(that.adBoxRight.width());var oBtn=parseInt(that.adBoxLeft.find(".sr-player-ico").width());var winHeight=$(window).height();var winWidth=parseInt($(window).width());var move=this.opt.browserVersion?oLeft+"px":oLeft+1+"px";var _eleWidth=oBtn*2+parseInt(that.boxScroll.outerWidth(true))+parseInt(that.opt.box.find(".sr-play-box-nav").width());var _eleAllWidth=oLeft+oRight+oBtn*2+parseInt(that.boxScroll.outerWidth(true))+parseInt(that.opt.box.find(".sr-play-box-nav").width());var adHide=function(){if(winWidth<_eleWidth){var _move=isComic?move:152;that.adBoxLeft.stop().animate({left:"-"+_move},that.opt.adTime);that.adBoxRight.stop().animate({right:"-"+_move},that.opt.adTime);
if(that.opt.box.find(".sr-asideBtn").hasClass("sr-hoverBtn")){that.opt.box.find(".sr-asideBtn").removeClass("sr-hoverBtn")}}else{that.adBoxLeft.stop().animate({left:"-"+move},that.opt.adTime);that.adBoxRight.stop().animate({right:"-"+move},that.opt.adTime);if(!(that.opt.box.find(".sr-asideBtn").hasClass("sr-hoverBtn"))){that.opt.box.find(".sr-asideBtn").addClass("sr-hoverBtn")}}};var adInit=function(){if(winWidth<_eleAllWidth){that.opt.adTimer=setTimeout(adHide,1000)}else{clearTimeout(that.opt.adTimer);that.opt.box.find(".sr-asideBtn").addClass("sr-hoverBtn");that.adBoxLeft.css({left:"-"+move});that.adBoxRight.css({right:"-"+move})}};SMK.cookie.set(that.opt.setAdKey,0);var adKey=SMK.cookie.get(that.opt.setAdKey);if(!adKey){SMK.cookie.set(that.opt.setAdKey,1)}else{if(adKey==0){clearTimeout(that.opt.adTimer);SMK.cookie.set(that.opt.setAdKey,0);if(that.opt.box.find(".sr-asideBtn").hasClass("sr-hoverBtn")){that.opt.box.find(".sr-asideBtn").removeClass("sr-hoverBtn")}if(winWidth<_eleAllWidth){that.opt.adTimer=setTimeout(adHide,1000)}else{that.adBoxLeft.css({left:0});that.adBoxRight.css({right:0})}}else{adInit()}}var adBoxBtn=this.opt.box.find(".sr-player-ico");var chanage=function(winHeight){if(!that.opt.advertise){adBoxBtn.each(function(){$(this).parents(".sr-asideBtn").html("")})}};chanage(winHeight);var asideBtn=this.opt.box.find(".sr-asideBtn");if(!that.opt.advertise){return}adBoxBtn.unbind().bind("click",function(){if(!SMK.cookie.get(that.opt.setAdKey)||SMK.cookie.get(that.opt.setAdKey)==1){SMK.cookie.set(that.opt.setAdKey,0)}else{SMK.cookie.set(that.opt.setAdKey,1)}var _this=$(this);if(that.opt.adClose){if(parseInt(that.adBoxLeft.css("left"))<0||parseInt(that.adBoxRight.css("right"))<0){that.adBoxLeft.stop().animate({left:0},that.opt.adTime);that.adBoxRight.stop().animate({right:0},that.opt.adTime);asideBtn.removeClass("sr-hoverBtn");that.trigger=1}else{that.adBoxLeft.stop().animate({left:"-"+move},that.opt.adTime);that.adBoxRight.stop().animate({right:"-"+move},that.opt.adTime);setTimeout(function(){asideBtn.addClass("sr-hoverBtn")},that.opt.adTime+100);that.trigger=0}}else{if($(this).data("direction")=="left"){if(parseInt(that.adBoxLeft.css("left"))<0){that.adBoxLeft.stop().animate({left:0},that.opt.adTime);$(this).parents(".sr-asideBtn").removeClass("sr-hoverBtn")}else{that.adBoxLeft.stop().animate({left:"-"+move},that.opt.adTime);setTimeout(function(){_this.parents(".sr-asideBtn").addClass("sr-hoverBtn")},that.opt.adTime+100)}that.trigger=1}else{if(parseInt(that.adBoxRight.css("right"))<0){$(this).parents(".sr-asideBtn").removeClass("sr-hoverBtn");that.adBoxRight.stop().animate({right:0},that.opt.adTime)}else{that.adBoxRight.stop().animate({right:"-"+move},that.opt.adTime);setTimeout(function(){_this.parents(".sr-asideBtn").addClass("sr-hoverBtn")},that.opt.adTime+100)}that.trigger=0}}isComic&&that.resizeAuto()})},readProgress:function(){var that=this;var progress=typeof that.opt.progress=="string"?$.parseJSON(that.opt.progress):that.opt.progress;if(!progress||!progress.channel){return}if(progress.channel!="pc"&&$CONFIG.islogin==1){if(progress.chapterId!=that.opt.chapterId){var chapter_name=progress.chapter_name||"新章节";var tips="您在其他平台上已阅读至《"+chapter_name+"》，是否确定跳转到该章？";SMK.util.confirm(tips,{title:"阅读进度",confirmCss:"btn-confirm",cancelCss:"btn-cancel",confirmCallback:function(){var href=location.href;var param=that.opt.bookId+"-"+progress.chapterId;location.href=href.replace(/\d+-\d+/,param)}})}}},mesTip:function(title,msg){var $body=$("body");var $el="<div class='btoast' ><p class='title'>"+title+"</p><p class='content'>"+msg+"</p></div>";$body.append($el);setTimeout(function(){$(".btoast").remove()},4000)},chapterError:function(){var that=this;$("body").on("click",".s-news-problem",function(e){e.preventDefault();if(!SMK.util.getLoginStatus()){SMK.util.checkLogin();return}var html=$("#errorTpl").html();SMK.pop.tips("",html,{title:"章节报错",width:360,mask:true,drag:false,callback:function($dlg){msgDlg=$dlg}})});$("body").on("focus",".s-problem-pop textarea",function(e){var defaultText=$(".s-problem-pop textarea").attr("data-default");if($(this).val()==defaultText){$(this).val("")}});$("body").on("blur",".s-problem-pop textarea",function(e){var defaultText=$(".s-problem-pop textarea").attr("data-default");if($(this).val()==""){$(this).val(defaultText)}});var arr=[];$("body").on("click",'.item input[type="checkbox"]',function(e){var val=$(this).val();if($(this).is(":checked")){arr.push(val)}else{$.each(arr,function(index,el){if(el==val){arr.splice(index,1);return false}});arr.splice(val)}if(arr.length>=1){$(".btn-submit").addClass("active")}else{$(".btn-submit").removeClass("active")}});$("body").on("click",".btn-submit",function(){if(!$(this).hasClass("active")){return false}var defaultText=$(".s-problem-pop textarea").attr("data-default");var check=$(".s-problem-con .item").find('input[type="checkbox"]');var arr=[];$.each(check,function(index,el){if($(el).is(":checked")){var val=$(el).val();arr.push(val)}});
var type=arr.join(",");var val=$(".s-problem-pop textarea").val();var ajaxParam={book_id:that.opt.bookId,chapter_id:that.opt.chapterId,type:type,content:val==defaultText?"":val};$.ajax({url:that.opt.bookReportUrl,type:"post",dataType:"json",data:ajaxParam}).done(function(data){msgDlg.find(".close a").click();if(data.error_code==0){that.mesTip("提交成功","小编会尽快为您解决问题哦！")}else{if(data.error_code==2){SMK.util.globalTips("今日反馈次数已达上限")}}}).fail(function(){msgDlg.find(".close a").click();SMK.util.globalTips("提交失败，请重新尝试！")})})},changeType:function(){$(document).on("click","#J_WordTrigger",function(){window.location.href=change_mode_url})}};var create=function(options){if(_lastObj){_lastObj=null}_lastObj=new play(options);return _lastObj};SMK.play.init=function(options){options=options==undefined?{}:options;try{(create(options).init()).__construct()}catch(e){}}})();