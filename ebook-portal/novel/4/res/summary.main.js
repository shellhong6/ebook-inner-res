define("scroll",["jquery"],function(e){e.extend({scrollBar:function(t){var n={scrollWrap:e("#period-list"),scrollCon:e("#period-list"),wrapHeight:177,scrollBarColor:"#333",scrollBarWidth:10,sliderColor:"#666",sliderRate:20},r=e.extend(n,t),i=r.wrapHeight;conHei=r.scrollCon.height();if(i>=conHei){r.scrollWrap.css("height","auto"),r.scrollCon.css({width:"auto",position:"static"}),e("#scrollBar").length&&e("#scrollBar").remove();return}r.scrollWrap.height(i);var s=function(){this.$scrollCon=r.scrollCon,this.$scrollWrap=r.scrollWrap,this.wrapHei=this.$scrollWrap.height()-2,this.conHei=this.$scrollCon.height(),this.scale=this.wrapHei/this.conHei,this.sliderHei=this.wrapHei*this.scale,this.scrollConWidth=this.$scrollCon.width(),this.$scrollCon.css({width:this.scrollConWidth,position:"absolute",top:"0"}),this.$scrollWrap.css({width:this.scrollConWidth+r.scrollBarWidth})};s.prototype={scrStyle:function(){var t='<div id="scrollBar" style="position:absolute;top:0;right:0;"><div id="slider" style="position:absolute;width:100%;border-radius: 5px;cursor:default"></div></div>';e("#scrollBar").length||this.$scrollWrap.append(t),this.$scrollBar=$scrollBar=e("#scrollBar"),this.$slider=$slider=e("#scrollBar").children(),$scrollBar.css({width:r.scrollBarWidth-2+"px",height:this.wrapHei,backgroundColor:r.scrollBarColor,border:"1px solid "+r.scrollBarColor}),$slider.css({backgroundColor:r.sliderColor,height:this.sliderHei})},sliderHover:function(){e("#slider").hover(function(){e(this).css("backgroundColor","#889195")},function(){e(this).css("backgroundColor","#ccc")})},_eventCompat:function(e){var t=e.type;if(t=="DOMMouseScroll"||t=="mousewheel")e.delta=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3;return e.srcElement&&!e.target&&(e.target=e.srcElement),!e.preventDefault&&e.returnValue!==undefined&&(e.preventDefault=function(){e.returnValue=!1}),e},addEvent:function(e,t,n,r){var i=this._eventCompat;window.addEventListener?(t==="mousewheel"&&document.mozHidden!==undefined&&(t="DOMMouseScroll"),e.addEventListener(t,function(e){n.call(this,i(e))},r||!1)):window.attachEvent&&e.attachEvent("on"+t,function(t){t=t||window.event,n.call(e,i(t))})},mouseWheel:function(){var e=this,t=this.conHei,n=this.wrapHei,i=this.sliderHei,s=this.scale;this.addEvent(this.$scrollWrap[0],"mousewheel",function(o){window.attachEvent?o.returnValue=!1:o.preventDefault();var u=e.$scrollCon[0].offsetTop+o.delta*r.sliderRate,a=e.$slider[0].offsetTop-o.delta*r.sliderRate*s;u=u>0?0:-u>t-n?n-t:u,a=a<0?0:a>n-i?n-i:a,e.$scrollCon.css("top",u),e.$slider.css("top",a)})},sliderClick:function(){var t,n,r,i=this.$slider,s=this.$scrollCon,o=this,u=this.scale,a=this.wrapHei,f=this.sliderHei,l=this.conHei;i.mousedown(function(e){if(e.which!==1)return;t=e.pageX,n=e.pageY,r=this.offsetTop,scrTop=s[0].offsetTop}),i.mousemove(function(t){if(t.which!==1)return;var i=r+(t.pageY-n),o=scrTop-(t.pageY-n)/u;i=i<0?0:i>a-f?a-f:i,o=o>0?0:-o>l-a?a-l:o,e(this).css("top",i),s.css("top",o)})},init:function(){this.scrStyle(),this.mouseWheel(),this.sliderClick(),this.sliderHover()}};var o=new s;o.init()}})}),require(["base","scroll"],function(e,t){var n=$(".book_txt .book_name em").width();n>=410?$(".book_txt .book_name span").addClass("long").removeClass("short"):$(".book_txt .book_name span").removeClass("long").addClass("short");var r="<ul><%_.each(list, function(page,i){ %><li data-page='<%=i%>'><%_.each(page, function(chapters, volume_name){%><h3><%=volume_name%></h3><%_.each(chapters, function(chapter, i){%><%if(i%2==0){ %><%if(i>0){%></p><%}%><p class='chapter'><%}%><%if(chapter.is_vip !=1){%><span><a target='_blank' title='<%=chapter.chapter_name%>' href='<%=chapter.chapter_url%>'><em><%=parseInt(chapter.index)+1%>.</em><%=chapter.chapter_name%></a></span><% }else{%><span><a target='' title='<%=chapter.chapter_name%>' href='<%=chapter.chapter_url%>'><em><%=parseInt(chapter.index)+1%>.</em><%=chapter.chapter_name%></a><i></i></span><%}%><%})%><%})%></li><%})%></ul>",i="",s='<div class="author_img"><a href="http://weibo.com/<%=data.id%>"><img src="<%=data.avatar_large%>"></a><%if(data.verified == true && data.verified_type == 0){%><span class="tag_v_y"></span><%}else if(data.verified == true && data.verified_type > 0 && data.verified_type <=7){%><span class="tag_v_b"></span><%}%></div><div class="author_int"><a href="http://weibo.com/<%=data.id%>"><%=data.screen_name%></a><p><a href="http://weibo.com/<%=data.id%>">进入作者微博&gt;&gt;</a></p></div><div class="clearfix"></div><div class="author_info_txt"><div class="author_info_s"><%=data.description%></div></div>',o='<div  class="popup-alert"><div class="popup-mask"></div><div class="popup-content"><div class="popup-title">提示</div><div class="popup-con"><p class="success">成功加入书架</p><p class="mes">你可在私信中查看你的<b>书架</b>哦</p></div><div class="popup-attention"><input type="checkbox" checked="checked">关注微博读书小助手</div><div class="popup-btn">确定</div></div></div>',u={scrollBar:function(){$.scrollBar({scrollWrap:$(".chapter_con_list"),scrollCon:$(".chapter_con_box"),wrapHeight:771,scrollBarColor:"#f9f5f1",scrollBarWidth:10,sliderColor:"#ccc",sliderRate:20})},lineColor:function(){var e=$(".chapter_con_box li p");for(var t=0;t<e.length;t++)t%2==0&&(e[t].style.backgroundColor="#fcfbf7")},fillInChapter:function(){function a(e,t){_.each(e,function(e,r){var i=Math.ceil((r+1)/50);t&&(i=t),r%50==0&&(n[i]||(n[i]={}),s=[],o=e.volume_name),o!=e.volume_name&&(s=[],o=e.volume_name),o&&(s.volume_name=o);var u=n[i];u&&(s.push(e),u[o]=s)})}var e=[],t=[],n={},i=0;if(!window.directoryData)return;_.each(directoryData.data.list,function(n){t.push({volume_name:n.volume_name,chapters:[]}),_.each(n.chapters,function(t){t.volume_name=n.volume_name,t.index=i,i+=1,e.push(t)})});var s,o="",u=e.length-50>=0?e.length-50:e.length;a(e),u>0&&a(_.tail(e,u),"last50");var f=_.template(r)({list:n});$(".chapter_con_box").html(f).show(),$(".loading_s").hide(),$(".chapter_tab dd").first().on("click",function(){var e=$(".chapter_con_box li");for(var t=0;t<e.length;t++)$(e[t]).hide();$(".chapter_con_box li").first().show()}),$(".chapter_tab dd").last().on("click",function(){var e=$(".chapter_con_box li");for(var t=0;t<e.length;t++)$(e[t]).hide();$(".chapter_con_box ul").find('[data-page="last50"]').show()})},pageForTab:function(){var e=0,t=50,n=directoryData.data.list;for(var r=0;r<n.length;r++)e+=n[r].chapters.length;e<=50&&$(".chapter_tab").hide();var s=Math.ceil(e/t),o=e%t;for(var u=0;u<s;u++)u==s-1?i+='<li><a href="javascript:;">'+(u*t+1)+"-"+e+"</a></li>":i+='<li><a href="javascript:;">'+(u*t+1)+"-"+(u+1)*t+"</a></li>";$(".catalog ul").append(i)},dirDialog:function(){var e=this,t=$(".chapter_tab dt"),n=t.find("ul");t.on("mouseover",function(){$(".catalog").show();var t=$(this).attr("data-tag");t==1&&(e.tabDirScroll(),$(this).attr("data-tag",2)),$(this).children().first().addClass("boxBtnHover")}),t.on("mouseout",function(){$(".catalog").hide(),$(this).children().first().removeClass("boxBtnHover")})},tabDirScroll:function(){$.scrollBar({scrollWrap:$(".catalog"),scrollCon:$(".catalog ul"),wrapHeight:500,scrollBarColor:"#f9f5f1",scrollBarWidth:10,sliderColor:"#ccc",sliderRate:20})},tabPageEvent:function(){var e=$(".catalog ul li"),t=$(".chapter_con_box ul li");$(t[0]).show();for(var n=0;n<e.length;n++)$(e[n]).on("click",function(n){n.stopPropagation(),$(".chapter_tab dd").removeClass("cur"),$(".chapter_tab dt").addClass("cur"),e.removeClass("cur"),$(this).addClass("cur");for(var r=0;r<e.length;r++)$(t[r]).hide();$(t[$(this).index()]).show()})},addBookshelf:function(e,t,n){if(!SMK.util.getLoginStatus())return;var r=this;$.ajax({url:_cfg.i_bookshelf+"?action="+t,type:"POSt",dataType:"json",data:{bids:e}}).done(function(r){n&&n();var i=r.data[e];t=="check"?r.data[e]==0?$(".btn_box").attr("data-tag",i):($(".btn_box").attr("data-tag",i),$(".btn_box").find(".btn_add").html("已加书架").addClass("cursor_txt")):r.data[e]==0?($(".btn_box").attr("data-tag",i),$(".btn_box").find(".btn_add").html("已加书架").addClass("cursor_txt")):$(".btn_box").attr("data-tag",i)}).fail(function(){SMK.util.globalTips("请求失败")})},addBookshelfEvent:function(e){var t=this;$(".btn_box").find(".btn_add").on("click",function(){if(!SMK.util.getLoginStatus())return SMK.util.checkLogin();var e=$(".btn_box").attr("data-tag");e==0&&t.addBookshelf(book_id,"add")})},tabBtnEvent:function(){$(".chapter_tab dd").on("click",function(e){$(".catalog ul li").removeClass("cur"),$(".chapter_tab dl").children().removeClass("cur"),$(this).addClass("cur")})},getAuthorInfo:function(){var e=this;book_uid_role<16?$.ajax({url:_cfg.i_weibouserinfo,type:"POSt",dataType:"json",data:{uid:book_uid}}).done(function(t){var n=_.template(s)({data:t.data});$(".author_info").html(n).show(),e.conOpen(75,".author_info_s")}).fail(function(){SMK.util.globalTips("请求失败")}):$(".author_info").hide()},conOpen:function(e,t){var t=$(t),n,r;t.height()>e?(t.height(e).css({height:e,display:"block",overflow:"hidden"}),n=$('<em class="openInfo"></em>'),r=t.clone().css({height:"auto",overflow:"visible"}),n.html('展开<span class="down"></span>').attr("data-static","open").appendTo(t.parent())):t.show(),t.parent().on("click",".openInfo",function(){var i=n.attr("data-static");i=="open"?(r.appendTo(t.parent()).show(),t.hide(),n.html('收起<span class="up"></span>').attr("data-static","colse")):(t.height(e).css({height:e,display:"block",overflow:"hidden"}),n.html('展开<span class="down"></span>').attr("data-static","open").appendTo(t.parent()),r.hide())})},init:function(){var e=this;if(!window.directoryData)return;e.fillInChapter(),e.lineColor(),e.pageForTab(),e.tabPageEvent(),e.dirDialog(),e.addBookshelf(book_id,"check"),e.addBookshelfEvent(1),e.getAuthorInfo(),e.tabBtnEvent(),e.conOpen(88,".info_txt")}};u.init()}),define("summary.main",function(){});